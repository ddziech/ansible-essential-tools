- name: remove old and unmantained zfs-fuse
  package:
    name: zfs-fuse
    state: absent
  become: true
  tags: zfs

- name: add zfs repo
  dnf:
    name: "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ansible_distribution_major_version}}.noarch.rpm"
    state: 'present'
  when: ansible_distribution == 'Fedora'
  become: true
  tags: zfs

- name: install kernel headers
  package:
    name: kernel-devel
    state: present
  become: true
  tags: zfs

- name: install zfs
  package:
    name: zfs
    state: present
  become: true
  tags: zfs

- name: modprobe zfs
  community.general.modprobe:
    name: zfs
    state: present

- name: load zfs at boot
  command: echo zfs > /etc/modules-load.d/zfs.conf
  become: true
  tags: zfs
